var A=Object.defineProperty,M=Object.defineProperties;var E=Object.getOwnPropertyDescriptors;var k=Object.getOwnPropertySymbols;var F=Object.prototype.hasOwnProperty,T=Object.prototype.propertyIsEnumerable;var z=(o,t,n)=>t in o?A(o,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):o[t]=n,f=(o,t)=>{for(var n in t||(t={}))F.call(t,n)&&z(o,n,t[n]);if(k)for(var n of k(t))T.call(t,n)&&z(o,n,t[n]);return o},C=(o,t)=>M(o,E(t));import{j,H as R,c as u,a as D,b as H,C as q,k as I,p as $,r as O,d as S,R as W,e as B,f as N}from"./vendor.8ccf301b.js";const U=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))l(e);new MutationObserver(e=>{for(const r of e)if(r.type==="childList")for(const s of r.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&l(s)}).observe(document,{childList:!0,subtree:!0});function n(e){const r={};return e.integrity&&(r.integrity=e.integrity),e.referrerpolicy&&(r.referrerPolicy=e.referrerpolicy),e.crossorigin==="use-credentials"?r.credentials="include":e.crossorigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function l(e){if(e.ep)return;e.ep=!0;const r=n(e);fetch(e.href,r)}};U();const i=j.exports.jsx,L=j.exports.jsxs,Z=({node:o,colours:t})=>{console.log(o.data());var{no:n,name:l,com:e,now:r,tim:s}=o.data();return e?L("div",{style:{backgroundColor:t.reply,padding:10,maxWidth:"35vw",pointerEvents:"none"},children:[s?i("img",{src:`https://i.4cdn.org/ck/${s}s.jpg`}):i("div",{}),i("div",{style:{color:t.name,fontWeight:"bold"},children:l}),i("div",{style:{fontFamily:"arial,helvetica,sans-serif"},children:R(e,{replace:d=>{var h;((h=d==null?void 0:d.attribs)==null?void 0:h.class)=="quote"&&console.log("quote",d)}})})]}):i("div",{})},G=({threadData:o})=>{var{posts:t}=o,n=t.find(a=>a.resto==0),l=a=>{var c=[];return a==n&&c.push("OP"),a.filename&&c.push("hasImage"),{classes:c,data:C(f({},a),{id:a.no,label:a.name})}},e=(a,c)=>({classes:c,data:f({weight:1},a)}),r=a=>[e({source:a.no,target:n.no},["noReply"])],s=a=>{var x;var c=[];if(!a.com)return[];var g=R(a.com);if(typeof g=="string"||g instanceof String)return r(a);Array.isArray(g)||(g=[g]);var y=g.filter(m=>m.type=="a");if(y.length<1)return r(a);var w=[];for(var P of y)w.push((x=P.props)==null?void 0:x.href.replace("#p",""));return[...new Set(w)].map(m=>e({source:a.no,target:m},c))},d=[],h=[];for(var v of t)d.push(l(v)),h=[...h,...s(v)];return{nodes:d,edges:h}},K=async({site:o,board:t,thread:n})=>await await fetch("https://jsonp.afeld.me/?url=https%3A%2F%2Fa.4cdn.org%2Fck%2Fthread%2F17129052.json").then(l=>l.json());var p=12,_=[{selector:"node[[degree>1]]",style:{"font-size":p*1.2}},{selector:"node[[degree>2]]",style:{"font-size":p*1.4}},{selector:"node[[degree>4]]",style:{"font-size":p*3}},{selector:"node[[degree>8]]",style:{"font-size":p*6}}],b={background:"rgb(239, 242, 254)",reply:"rgb(215,  218, 238)",name:"rgb(54,  117, 72)",subject:"rgb(28, 24,  98)",quote:"rgb(131, 155, 65)"};const J=[{selector:"node",style:{"background-color":b.reply,width:"label",height:"label",padding:"6px",shape:"round-rectangle","border-width":"1"}},{selector:"node[label]",style:{label:"data(label)","font-size":p,color:b.name,"text-halign":"center","text-valign":"center"}},{selector:"edge",style:{"curve-style":"unbundled-bezier","arrow-scale":.5,width:2}},{selector:"edge[name]",style:{"font-size":p,"text-background-color":"white","text-background-opacity":1,"text-background-padding":"2px","text-border-color":"black","text-border-style":"solid","text-border-width":.5,"text-border-opacity":1,"text-rotation":"autorotate"}},{selector:"node[weight]",style:{"font-size":"data(weight)"}},..._,{selector:"edge",style:{width:"3","line-style":"solid"}},{selector:"edge.noReply",style:{width:"2","line-style":"dotted","line-dash-offset":24,"line-dash-pattern":[6,3]}},{selector:".managed",style:{"font-size":"12","text-background-color":"lightgrey","line-style":"solid"}},{selector:"node:selected",style:{"border-color":"red","border-width":"5"}},{selector:".neighbor-selected.successor",style:{"border-color":"blue","border-width":"2","line-color":"blue"}},{selector:".neighbor-selected.incoming",style:{"border-color":"green","border-width":"3","line-color":"green"}},{selector:".neighbor-selected.outgoing",style:{"border-color":"orange","border-width":"3","line-color":"orange"}},{selector:"edge.neighbor-selected.highlight",style:{label:"data(name)","control-point-step-size":30}},{selector:"edge.neighbor-selected.highlight",style:{label:"data(name)","control-point-step-size":30}},{selector:"node.highlight",style:{"border-color":"red","border-width":"3"}},{selector:"edge.highlight",style:{width:2.5,"target-arrow-shape":"triangle","arrow-scale":1}},{selector:"edge.hover.highlight",style:{width:2.5}},{selector:"node.OP",style:{"font-weight":"bold"}}];u.use(D);u.use(H);u.use(q);u.use(I);u.use($);var Q={name:"klay",klay:{direction:"UP",fixedAlignment:"RIGHTDOWN",edgeSpacingFactor:.1}};const V=o=>o.popper({content:()=>{let t=document.createElement("div");return t.innerHTML=W.renderToStaticMarkup(i(Z,{node:o,colours:b})),document.body.appendChild(t),t}}),X=o=>{const[t,n]=O.exports.useState(),l=new URLSearchParams(window.location.search);return O.exports.useEffect(()=>{console.log(f({},l));var e=l.get("thread"),r=l.get("site")||"4chan",[e,,s]=e.split("/").reverse(),d={site:r,thread:e,board:s};[r,s,e].includes(void 0)&&(d={site:"4chan",board:"ck",thread:"17130545"}),console.log("Calling",d),K(d).then(n)},[]),t?i(S,{cy:e=>{e.ready(function(r){e.fit()}),e.on("select","node",function(r){console.log(this.data("id"),this.data("com")),this.incomers().addClass("neighbor-selected incoming"),this.outgoers().addClass("neighbor-selected outgoing"),this.successors().addClass("neighbor-selected successor")}),e.on("unselect","node",function(r){this.incomers().removeClass("neighbor-selected incoming"),this.outgoers().removeClass("neighbor-selected outgoing"),this.successors().removeClass("neighbor-selected successor")}),e.on("mouseover","node",function(r){this.data("popper",V(this))}),e.on("mouseout","node",function(r){var s=this.data("popper");s&&(s.destroy(),this.data("popper",void 0))}),e.on("node","position",function(r){var s;(s=e.$("[?popper]").data("popper"))==null||s.update()}),e.on("pan zoom resize",function(r){var s;(s=e.$("[?popper]").data("popper"))==null||s.update()})},zoom:2,style:{width:"100%",height:"600px",backgroundColor:b.background},minZoom:.5,maxZoom:5,elements:S.normalizeElements(G({threadData:t})),layout:Q,stylesheet:J}):i("b",{children:"Loading!"})};function Y(){return L("div",{className:"App",children:[i("header",{className:"App-header",children:"text"}),i("div",{children:i(X,{})})]})}B.render(i(N.StrictMode,{children:i(Y,{})}),document.getElementById("root"));
