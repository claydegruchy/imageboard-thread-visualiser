var E=Object.defineProperty,M=Object.defineProperties;var F=Object.getOwnPropertyDescriptors;var R=Object.getOwnPropertySymbols;var N=Object.prototype.hasOwnProperty,T=Object.prototype.propertyIsEnumerable;var S=(s,t,o)=>t in s?E(s,t,{enumerable:!0,configurable:!0,writable:!0,value:o}):s[t]=o,u=(s,t)=>{for(var o in t||(t={}))N.call(t,o)&&S(s,o,t[o]);if(R)for(var o of R(t))T.call(t,o)&&S(s,o,t[o]);return s},L=(s,t)=>M(s,F(t));import{j as O,H as v,c as g,a as $,b as D,C as H,k as q,p as I,r as A,d as P,R as W,e as B,f as U}from"./vendor.8ccf301b.js";const Z=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))i(e);new MutationObserver(e=>{for(const r of e)if(r.type==="childList")for(const n of r.addedNodes)n.tagName==="LINK"&&n.rel==="modulepreload"&&i(n)}).observe(document,{childList:!0,subtree:!0});function o(e){const r={};return e.integrity&&(r.integrity=e.integrity),e.referrerpolicy&&(r.referrerPolicy=e.referrerpolicy),e.crossorigin==="use-credentials"?r.credentials="include":e.crossorigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function i(e){if(e.ep)return;e.ep=!0;const r=o(e);fetch(e.href,r)}};Z();const l=O.exports.jsx,y=O.exports.jsxs,G=({node:s,colours:t})=>{var{no:o,name:i,com:e,now:r,tim:n,sub:d}=s.data();return console.log(s.data()),y("div",{style:{backgroundColor:t.reply,padding:10,maxWidth:"35vw",pointerEvents:"none"},children:[n?l("img",{src:`https://i.4cdn.org/ck/${n}s.jpg`}):l("div",{}),l("div",{style:{color:t.name,fontWeight:"bold"},children:i}),l("div",{style:{fontFamily:"arial,helvetica,sans-serif"},children:e?v(e):""}),d?y("div",{style:{color:t.subject,fontWeight:"bold"},children:[" ",v(d)," "]}):""]})},K=({threadData:s})=>{var{posts:t}=s,o=t.find(a=>a.resto==0),i=a=>{var c=[];return a==o&&c.push("OP"),a.filename&&c.push("hasImage"),{classes:c,data:L(u({},a),{id:a.no,label:a.name})}},e=(a,c)=>({classes:c,data:u({weight:1},a)}),r=a=>[e({source:a.no,target:o.no},["noReply"])],n=a=>{var C,j;var c=[];if(!a.com)return[];var h=v(a.com);if(typeof h=="string"||h instanceof String)return r(a);Array.isArray(h)||(h=[h]);var x=h.filter(b=>b.type=="a");if(x.length<1)return r(a);var k=[];for(var z of x)((C=z.props)==null?void 0:C.href.includes("/"))||k.push((j=z.props)==null?void 0:j.href.replace("#p",""));return[...new Set(k)].map(b=>e({source:a.no,target:b},c))},d=[],m=[];for(var w of t)d.push(i(w)),m=[...m,...n(w)];return{nodes:d,edges:m}},_=async({site:s,board:t,thread:o})=>await await fetch(`https://jsonp.afeld.me/?url=https%3A%2F%2Fa.4cdn.org%2F${t}%2Fthread%2F${o}.json`).then(i=>i.json());var p=12,J=[{selector:"node[[degree>1]]",style:{"font-size":p*1.2}},{selector:"node[[degree>2]]",style:{"font-size":p*1.4}},{selector:"node[[degree>4]]",style:{"font-size":p*3}},{selector:"node[[degree>8]]",style:{"font-size":p*6}}],f={background:"rgb(239, 242, 254)",reply:"rgb(215,  218, 238)",name:"rgb(54,  117, 72)",subject:"rgb(28, 24,  98)",quote:"rgb(131, 155, 65)"};const Q=[{selector:"node",style:{"background-color":f.reply,width:"label",height:"label",padding:"6px",shape:"round-rectangle","border-width":"1"}},{selector:"node[label]",style:{label:"data(label)","font-size":p,color:f.name,"text-halign":"center","text-valign":"center"}},{selector:"edge",style:{"curve-style":"unbundled-bezier","arrow-scale":.5,width:2}},{selector:"edge[name]",style:{"font-size":p,"text-background-color":"white","text-background-opacity":1,"text-background-padding":"2px","text-border-color":"black","text-border-style":"solid","text-border-width":.5,"text-border-opacity":1,"text-rotation":"autorotate"}},{selector:"node[weight]",style:{"font-size":"data(weight)"}},...J,{selector:"edge",style:{width:"3","line-style":"solid"}},{selector:"edge.noReply",style:{width:"2","line-style":"dotted","line-dash-offset":24,"line-dash-pattern":[6,3]}},{selector:".managed",style:{"font-size":"12","text-background-color":"lightgrey","line-style":"solid"}},{selector:"node:selected",style:{"border-color":"red","border-width":"5"}},{selector:".neighbor-selected.successor",style:{"border-color":"blue","border-width":"2","line-color":"blue"}},{selector:".neighbor-selected.incoming",style:{"border-color":"green","border-width":"3","line-color":"green"}},{selector:".neighbor-selected.outgoing",style:{"border-color":"orange","border-width":"3","line-color":"orange"}},{selector:"edge.neighbor-selected.highlight",style:{label:"data(name)","control-point-step-size":30}},{selector:"edge.neighbor-selected.highlight",style:{label:"data(name)","control-point-step-size":30}},{selector:"node.highlight",style:{"border-color":"red","border-width":"3"}},{selector:"edge.highlight",style:{width:2.5,"target-arrow-shape":"triangle","arrow-scale":1}},{selector:"edge.hover.highlight",style:{width:2.5}},{selector:"node.OP",style:{"font-weight":"bold"}}];g.use($);g.use(D);g.use(H);g.use(q);g.use(I);var V={name:"klay",klay:{direction:"UP",fixedAlignment:"RIGHTDOWN",edgeSpacingFactor:.1}};const X=s=>s.popper({content:()=>{var t=s.data("no"),o=document.querySelector(`#id-${t}`);if(o)var i=o;else{let e=document.createElement("div");e.id=`id-${t}`,e.className="pop",e.innerHTML=W.renderToStaticMarkup(l(G,{node:s,colours:f})),document.body.appendChild(e);var i=e}return[...document.querySelectorAll(".pop")].forEach(e=>e.classList.add("hidden")),i.classList.remove("hidden"),i}}),Y=s=>{const[t,o]=A.exports.useState(),i=new URLSearchParams(window.location.search);return A.exports.useEffect(()=>{console.log(u({},i));var e=i.get("thread");if(e){var r=i.get("site")||"4chan",[e,,n]=e.split("/").reverse(),d={site:r,thread:e,board:n};[r,n,e].includes(void 0)&&(d={site:"4chan",board:"ck",thread:"17130545"})}else var d={site:"4chan",board:"ck",thread:"17130545"};console.log("Calling",d),_(d).then(o)},[]),t?l(P,{cy:e=>{e.ready(function(r){e.fit()}),e.on("select","node",function(r){console.log(this.data("id"),this.data("com")),this.incomers().addClass("neighbor-selected incoming"),this.outgoers().addClass("neighbor-selected outgoing"),this.successors().addClass("neighbor-selected successor")}),e.on("unselect","node",function(r){this.incomers().removeClass("neighbor-selected incoming"),this.outgoers().removeClass("neighbor-selected outgoing"),this.successors().removeClass("neighbor-selected successor")}),e.on("mouseover","node",function(r){this.data("popper",X(this))}),e.on("mouseout","node",function(r){var n=this.data("popper");n&&(n.destroy(),this.data("popper",void 0))}),e.on("node","position",function(r){var n;(n=e.$("[?popper]").data("popper"))==null||n.update()}),e.on("pan zoom resize",function(r){var n;(n=e.$("[?popper]").data("popper"))==null||n.update()})},zoom:2,style:{width:"100%",height:"600px",backgroundColor:f.background},minZoom:.2,maxZoom:5,elements:P.normalizeElements(K({threadData:t})),layout:V,stylesheet:Q}):l("b",{children:"Loading!"})};function ee(){return y("div",{className:"App",children:[l("header",{className:"App-header"}),l("div",{children:l(Y,{})})]})}B.render(l(U.StrictMode,{children:l(ee,{})}),document.getElementById("root"));
